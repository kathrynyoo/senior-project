<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <link rel="stylesheet" href="/style.css">
        <title>Pet Patrol</title>
    </head>
    <body>
        <nav>
            <h4>Pet Patrol</h4>
            <ul>
                <li><a href="/">Home</a></li>
                {{#if user}}
                    <li><a href="/logout">Logout</a></li>
                    {{#if isAdmin}}
                        <li><a href="/adminHome">Admin Panel</a></li>
                    {{/if}}
                    {{else}}
                        <li><a href="/requestAccount">Sign Up</a></li>
                        <li><a href="/login">Login</a></li>
                {{/if}}
            </ul>
        </nav>

        <div class="container mt-4">
            {{#if message}}
                <h4 class="alert alert-danger mt-4">{{message}}</h4>
            {{/if}}
        </div>
        

        <div class="container">
            <table class="table">
                <thead>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Last Login</th>
                    <th scope="col">Verification</th>
                    <th scope="col">Options</th>
                </thead>
                <tbody>
                    {{#each users}}
                        <tr>
                            <td>{{this.name}}</td>
                            <td>{{this.email}}</td>
                            <td>{{this.phone}}</td>
                            {{#if (isExpired this.lastLogin)}}
                                <td style="color:red">{{this.lastLogin}}</td>
                                {{else}}
                                    <td>{{this.lastLogin}}</td>
                            {{/if}}
                            <td>{{this.verification}}</td>
                            {{#if (isAdmin this.isAdmin)}}
                                <td>
                                    <form action="/auth/noAdmin" method="POST">
                                    <input type="hidden" name="user_id" value="{{this.user_id}}">
                                    <input type="submit" value="Remove Admin Status">
                                    </form>
                                </td>
                                {{else}}
                                <td>
                                    <form action="/auth/makeAdmin" method="POST">
                                    <input type="hidden" name="user_id" value="{{this.user_id}}">
                                    <input type="submit" value="Grant Admin Status">
                                    </form>
                                </td>
                            {{/if}}
                            <td>
                                <form action="/auth/deleteUser" method="POST">
                                    <input type="hidden" name="user_id" value="{{this.user_id}}">
                                    <input type="submit" value="Delete User">
                                </form>
                                {{#if (isExpired this.lastLogin)}}
                                <form action="/auth/reverify" method="POST">
                                    <input type="hidden" name="user_id" value="{{this.user_id}}">
                                    <input type="submit" value="Prompt Reverification" style="background-color: red;">
                                </form>
                                {{else}}
                                <form action="/auth/reverify" method="POST">
                                    <input type="hidden" name="user_id" value="{{this.user_id}}">
                                    <input type="submit" value="Prompt Reverification">
                                </form>
                                {{/if}}                                
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>


        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    </body>
</html>